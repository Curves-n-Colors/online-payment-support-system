var $modal = $("#master-auth-modal"),
    $form = $("#master-auth-form"),
    $pass = $("#master-auth-password");
$(document).on("click", ".btn-proceed-init", function (e) {
    e.preventDefault();
    $form.attr("action", $(this).data("url"));
    $modal.modal("show");
    $pass.val("");
    $(".btn-proceed").html("Proceed").prop("disabled", false);
});
$(document).on("click", ".btn-proceed", function (e) {
    e.preventDefault();
    var $this = $(this);
    var random = $this.data('random')
    if ($pass.val() == "") {
        notify_bar("danger", "Enter Your Master Password");
        return false;
    }
    $.ajax({
        url: $form.attr("action"),
        type: "PUT",
        data: $form.serialize(),
        async: true,
        beforeSend: function () {
            $this.html("Loading...").prop("disabled", true);
        },
        success: function (response) {
            $pass.val("").html("Proceed").prop("disabled", false);
            if (response.status) {
                if (response.link) {
                    copyToClipboard(response.link);
                }
                notify_bar("info", response.msg);
                $modal.modal("hide");
                $form.attr("action", "");
            } else {
                notify_bar("danger", response.msg);
            }
        },
        complete: function () {
            $pass.val("");
            $this.html("Proceed").prop("disabled", false);
            console.log($('.setup-'+random))
            $('#setup-table-list tr[id=setup-'+random+']').hide('slow', function(){ $(this).remove(); })
        },
    });
});
var $refund_modal = $("#master-auth-refund-modal"),
    $refund_form = $("#master-auth-refund-form"),
    $refund_pass = $("#master-auth-refund-password"),
    $refund_curr = $(".refund-currency"),
    $refund_ttl = $("#refund-total"),
    $refund_amt = $("#refund-amount"),
    $refund_ref = $("#refund-ref-code"),
    $refund_full = $("#refund-full");
$(document).on("click", ".btn-refund", function (e) {
    e.preventDefault();
    var $list_item = $(this).parents(".list-item");
    $refund_form.attr("action", $(this).data("url"));
    $refund_pass.val("");
    $refund_curr.html($list_item.find("[data-title=currency]").val());
    $refund_ttl.val($list_item.find("[data-title=total_amount]").val());
    $refund_amt.prop("disabled", true).val($list_item.find("[data-title=total_amount]").val());
    $refund_ref.val($list_item.find("[data-title=ref_code]").val());
    $refund_full.prop("checked", true);
    $refund_modal.modal("show");
    $(".btn-proceed-refund").html("Proceed").prop("disabled", false);
});
$(document).on("click", ".btn-proceed-refund", function (e) {
    e.preventDefault();
    var $this = $(this);
    if ($refund_pass.val() == "") {
        notify_bar("danger", "Enter Your Master Password");
        return false;
    }
    $.ajax({
        url: $refund_form.attr("action"),
        type: "PUT",
        data: $refund_form.serialize(),
        async: true,
        beforeSend: function () {
            $this.html("Loading...").prop("disabled", true);
        },
        success: function (response) {
            $refund_pass.val("").html("Proceed").prop("disabled", false);
            if (response.status) {
                notify_reload("info", response.msg);
                $refund_modal.modal("hide");
                $refund_form.attr("action", "");
                $refund_curr.html("");
                $refund_ttl.val("");
                $refund_amt.val("");
                $refund_ref.val("");
                $refund_full.prop("checked", true);
            } else {
                notify_bar("danger", response.msg);
            }
        },
        complete: function () {
            $refund_pass.val("");
            $this.html("Proceed").prop("disabled", false);
        },
    });
});
$(document).on("change", "#refund-full", function (e) {
    if ($(this).is(":checked")) {
        $refund_amt.prop("disabled", true).val($refund_ttl.val());
    } else {
        $refund_amt.prop("disabled", false).val($refund_ttl.val());
    }
});
